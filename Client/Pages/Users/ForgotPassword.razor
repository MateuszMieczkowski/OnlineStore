@page "/users/forgot-password"
@using System.ComponentModel.DataAnnotations
@inject ToastService Toast
@inject IAccountService AccountService


<div class="container p-5">
    <h3>Odzyskiwanie hasła</h3>
    <MudItem>
        <MudItem>
            <EditForm Model="_resetPasswordModel" OnValidSubmit="HandleResetPassword">
                <DataAnnotationsValidator></DataAnnotationsValidator>
                <div class="form-group">
                    <MudTextField @bind-Value="_resetPasswordModel.Email" Label="E-mail" Placeholder="Wpisz" InputType="InputType.Email" id="email" For="@(() => _resetPasswordModel.Email)"/>
                </div>
                <MudButton ButtonType="ButtonType.Submit" Variant="Variant.Filled" Color="Color.Primary">Wyślij prośbę o zresetowanie hasła</MudButton>
            </EditForm>
        </MudItem>
    </MudItem>
</div>

@code {
    private ResetPasswordModel _resetPasswordModel = new();

    private async Task HandleResetPassword()
    {
        var successMessage = "Jeśli adres e-mail istnieje w systemie, otrzymasz wiadomość z instrukcją zresetowania hasła.";

        try
        {
            await AccountService.ForgotPassword(_resetPasswordModel.Email);
            Toast.ShowToast(successMessage, ToastLevel.Success);
        }
        catch (Exception ex)
        {
            Toast.ShowToast(ex.Message, ToastLevel.Error);
        }
    }

    private class ResetPasswordModel
    {
        [Required(ErrorMessage = "E-mail jest wymagany do zresetowania hasła")]
        [EmailAddress(ErrorMessage = "Wprowadzono nieprawidłowy adres e-mail")]
        public string Email { get; set; }
    }
}